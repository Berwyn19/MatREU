# MatREU

# Moment Tensor Potentials
## Training Moment Tensor Potentials
+ All of the required files for training moment tensor potentials are within the `local-mtp` directory
+ Navigate to the mlip-2 directory and run `./configure --no-mpi`
+ Run `make mlp` in to allow running `mlp` commands for training
+ In order to be able to excecute `mlp` commands from any directory, open `~/.bashrc` with any text editor and export the path to the `bin` file generated by the `make mlp` command via `export PATH="$PATH:<path_to_bin>"`, then run `source ~/.bashrc`
+ `training-berwyn` is the directory dedicated to training the machine learning potentials
  + `config.mtp` is the configuration file for the training. For this file, don't change anything other than the min-dist, max-dist, and species_counts. In order to use different configuration files, navigate to untrained_mtps to select configurations with different maximum level (08.mtp corresponds to maximum level of 8). To get the minimum distance between atoms in the training file, run `mlp mindist` or simply add `--update-mindist` flag later when running the training commands
  + All the training, validation, and test datasets should be converted into the `.cfg` file. To perform the conversion from `.xyz` file to `.cfg` file, change the `filename` variable inside `xyz_to_cfg.py` to the desired path and run the script
  + To run the training use `mlp train` command, you can also run `mlp help train` to see what available flags to use. A simple example of running a training with 50 iterations and a specific validation dataset is `mlp train potential.mtp train_set.cfg --max-iter=50 valid-cfgs=<path_to_validation_dataset>`, where `potential.mtp` is the training configuration file and `train_set.cfg` is the training dataset
  + After the training is finished, a file called `Trained.mtp_` will be created, this is where the model is saved and can be used for evaluation

## Training Interlayer Models
+ The default code in the repo now is for interlayer training. For intralayer training, you can change the code inside `neighborhood.cpp` under the `src` directory by understanding which pieces of code support the interlayer training
+ In the header file `neighborhood.h`, I added a private variable `ghost_atom_types` which is a vector to store the types of the ghost atoms constructed inside the `InitNbhs_AddGhostAtoms` in `neighborhood.cpp`
+ The lines of code for handling interlayer neighborhood construction are shown on line 112-114 inside the `neighborhood.cpp` file. This is where the types of the `ij` pairs are evaluated to see if they are within different layers
+ Potential further improvement might be to tinker with the Makefile or trace through the training code so that we can run either interlayer or intralayer training only via command line without having to always change the code

## Evaluation of Models
+ If you are only interested to retrieve the values for the evaluation metrics like forces or energies RMSE, run `mlp calc-errors pot.mtp db.cfg`, where `pot.mtp` is the model file (`Trained.mtp_` by default if you did not specify where to save to model when executing the training command) and `db.cfg` is the test dataset
+ If you are interested in visualizing the prediction, then you might want to generate predictions in a form of `.cfg` file by running `mlp calc-efs pot.mtp in.cfg out.cfg`, where `in.cfg` is the test dataset and `out.cfg` is the `.cfg` file to save the predictions in.
+ To extract the forces from `out.cfg`, you can use `get_forces.py` which will return a nested list of forces with dimension `number_of_configurations x number_of_atoms_per_configuration x 3`. To run this script, first open `get_forces.py` and specify a path to a `json` file for storing the list
